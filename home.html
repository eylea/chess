<!DOCTYPE html>
<html lang="en">

<head>
    <script>
        // @param {string} elementID
        // @param {string} fen
        // @return {void}
        const renderChessBoard = (function () {
            const pieceImages = {
                'r': 'static/rook-b.svg',
                'n': 'static/knight-b.svg',
                'b': 'static/bishop-b.svg',
                'q': 'static/queen-b.svg',
                'k': 'static/king-b.svg',
                'p': 'static/pawn-b.svg',
                'R': 'static/rook-w.svg',
                'N': 'static/knight-w.svg',
                'B': 'static/bishop-w.svg',
                'Q': 'static/queen-w.svg',
                'K': 'static/king-w.svg',
                'P': 'static/pawn-w.svg'
            };

            const pieceImageElements = {};
            let imagesLoaded = false;

            // Load the piece images
            for (const [piece, src] of Object.entries(pieceImages)) {
                const img = new Image();
                img.src = src;
                pieceImageElements[piece] = img;
            }

            // Wait for all images to load
            const imageLoadPromise = Promise.all(Object.values(pieceImageElements).map(img => {
                return new Promise(resolve => {
                    img.onload = resolve;
                });
            })).then(() => {
                imagesLoaded = true;
            });

            return function renderChessBoard(elementID, fen) {
                const canvas = document.getElementById(elementID);
                const ctx = canvas.getContext('2d');
                const boardSize = 8;
                const cellSize = 100;
                const boardWidth = cellSize * boardSize;
                const boardHeight = cellSize * boardSize;

                canvas.width = boardWidth;
                canvas.height = boardHeight;

                // Draw the board
                for (let i = 0; i < boardSize; i++) {
                    for (let j = 0; j < boardSize; j++) {
                        if ((i + j) % 2 === 0) {
                            ctx.fillStyle = '#EBECD0';
                        } else {
                            ctx.fillStyle = '#779556';
                        }
                        ctx.fillRect(i * cellSize, j * cellSize, cellSize, cellSize);
                    }
                }

                // Parse the FEN string and draw the pieces
                function drawPieces() {
                    const rows = fen.split(' ')[0].split('/');
                    for (let r = 0; r < boardSize; r++) {
                        let col = 0;
                        for (const char of rows[r]) {
                            if (char >= '1' && char <= '8') {
                                col += parseInt(char);
                            } else {
                                const piece = pieceImageElements[char];
                                ctx.drawImage(piece, col * cellSize, r * cellSize, cellSize, cellSize);
                                col++;
                            }
                        }
                    }
                }

                if (imagesLoaded) {
                    drawPieces();
                } else {
                    imageLoadPromise.then(drawPieces);
                }
            };
        })();

    </script>
</head>

<canvas id="chessBoard"></canvas>
<script>
    const fen = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR';
    renderChessBoard('chessBoard', fen);
</script>

</html>
